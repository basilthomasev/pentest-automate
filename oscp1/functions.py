import os
import time
import sys
import nmap # import nmap.py module
from colorama import Fore, Back, Style


# whois database

def whois(ip,folder):
    os.system("whois "+ip)
    os.system("cd "+folder +"&& curl https://api.hackertarget.com/whois/?q="+ip +" -o whois.txt"+" "+ "&& cd ./..")

# traceroute database

def traceroute(ip,folder):
    print " "
    print " "
    print (Fore.GREEN+" Traceroute database ")
    print " ------------------------------------------------------------------------------"
    print " "
    os.system("traceroute "+ip )
    os.system("cd "+folder +"&& curl https://api.hackertarget.com/mtr/?q="+ip +" -o traceroute.txt"+" "+ "&& cd ./..")

# dnslookup database

def dnslookup(ip,folder):
    print " "
    print " "
    print (Fore.BLUE+" DSNlookup database ")
    print " ------------------------------------------------------------------------------"
    print " "
    os.system("nslookup "+ip )
    os.system("cd "+folder +"&& curl https://api.hackertarget.com/dnslookup/?q="+ip +" -o dnslookup.txt"+" "+ "&& cd ./..")

# http headers database

def http_headers(ip,folder):
    print " "
    print " "
    print (Fore.GREEN+" https header database ")
    print " ------------------------------------------------------------------------------"
    print " "
    os.system("curl -i "+ip )
    os.system("cd "+folder +"&& curl https://api.hackertarget.com/httpheaders/?q="+ip +" -o http_header.txt"+" "+ "&& cd ./..")



# other common functions
# ----------------------
# ----------------------



# nmap
def nmap_full(ip,folder):
    nm = nmap.PortScanner()
    nm.scan(hosts = ip, arguments = " -sC -sV -R -PN -PS -p- --script vuln -O -oG nmaps_"+ip+".nmap")
    os.system("mv nmaps_"+ip+".txt "+folder)
    print(Fore.GREEN+" ")
    os.system("cat "+folder+"/nmaps_"+ip+".txt")
    finished()

# nmap nmap_machines
def nmap_normalPorts(ip,folder):
    nm = nmap.PortScanner()
    nm.scan(hosts = ip, arguments = " -sC -sV -p 1-10000 -O -oN nmap_"+ip+".txt")
    os.system("mv nmap_"+ip+".txt "+folder+"/NMAP_RESULT/")
    print(Fore.GREEN+" ")
    os.system("cat "+folder+"/NMAP_RESULT/nmap_"+ip+".txt")
    finished()

# enum4linux
def enum4linux(ip,folder):
    os.system("mkdir "+folder+"/ENUM4LINUX")
    os.system("enum4linux "+ip+" | tee -a enum4linux_"+ip+".txt")
    os.system("mv enum4linux_"+ip+".txt "+folder+"/ENUM4LINUX/")



#############################################
#================= Port 80 =================
#############################################

# nikto
def nikto80(ip,folder):
    os.system("mkdir "+folder+"/NIKTO")
    os.system("nikto -host http://"+ip+" -o nikto80.txt -f")
    os.system("mv nikto80.txt "+folder+"/NIKTO/")
    print(Fore.CYAN+" ")
    print " Nikto"
    print " -----"
    os.system("cat "+folder+"/NIKTO/nikto80.txt")
    finished()

# gobuster
def gobuster80(ip, folder):
    print(Fore.BLUE+" ")
    os.system("mkdir "+folder+"/GOBUSTER")
    os.system(" gobuster  -u http://"+ip+" -r -t 5 -w /usr/share/wordlists/dirb/big.txt -o gobuster80.log")
    os.system("mv gobuster80.log "+folder+"/GOBUSTER/")

def dirb80(ip, folder):
    print(Fore.YELLOW+" ")
    os.system("mkdir "+folder+"/DIRB")
    os.system(" dirb http://"+ip+" -o dirb80.txt -f")
    os.system("mv dirb80.txt "+folder+"/DIRB/")
    finished()
    print " Hold on, results of other scanners are processing :) "



#############################################
#================= Port 443 =================
#############################################

# gobuster url
def gobuster443(ip, folder):
    print(Fore.BLUE+" ")
    os.system(" gobuster  -u https://"+ip+" -r -t 5 -w /usr/share/wordlists/dirb/big.txt -o gobuster443.log")
    os.system("mv gobuster443.log "+folder+"/GOBUSTER/")
    print(Fore.YELLOW+" ")

def dirb443(ip, folder):
    os.system(" dirb https://"+ip+" -o dirb443.txt -f")
    os.system("mv dirb443.txt "+folder+"/DIRB/")
    finished()
    print " Hold on, results of other scanners are processing :) "

# nikto
def nikto443(ip,folder):
    os.system("nikto -host https://"+ip+" -o nikto443.txt")
    os.system("mv nikto_"+ip+".txt "+folder+"/NIKTO/")
    print(Fore.CYAN+" ")
    print " Nikto"
    print " -----"
    os.system("cat "+folder+"/nikto443.txt")
    finished()

# testssl
def testssl443(ip,folder):
    os.system("mkdir "+folder+"/TESTSSL")
    os.system("./Tools/testssl/testssl.sh "+ip+" | tee -a testssl_"+ip+".txt")
    os.system("mv testssl_"+ip+".txt "+folder+"/TESTSSL/")
    os.system("cat "+folder+"/testssl_"+ip+".txt")


#############################################
# =========== Port finding =================
#############################################
def find_ports(ip, folder):
    arr = []
    os.system("mkdir "+folder+"/NMAP_RESULT")
    os.system("nmap -p 1-10000 "+ip+" -oA "+folder+"/NMAP_RESULT/Ports")
    os.system("cat "+folder+"/NMAP_RESULT/Ports.nmap | grep open | cut -d '/' -f 1 > AllPorts_"+ip+".txt")
    os.system("mv AllPorts_"+ip+".txt "+folder+"/NMAP_RESULT/")
    path = folder+"/NMAP_RESULT/AllPorts_"+ip+".txt"
    fo = open(path, "rw+")
    file_read = fo.readlines()
    for lists in file_read:
        arr.append(lists)
    return arr

# Fininshed message
def finished():
    print "==========================================="
    print "          FINISHED                         "
    print "==========================================="
