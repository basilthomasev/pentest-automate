import os
import time
import sys
import nmap # import nmap.py module
from colorama import Fore, Back, Style


# whois database

def whois(ip,folder):
    os.system("whois "+ip)
    os.system("cd "+folder +"&& curl https://api.hackertarget.com/whois/?q="+ip +" -o whois.txt"+" "+ "&& cd ./..")

# traceroute database

def traceroute(ip,folder):
    print " "
    print " "
    print (Fore.GREEN+" Traceroute database ")
    print " ------------------------------------------------------------------------------"
    print " "
    os.system("traceroute "+ip )
    os.system("cd "+folder +"&& curl https://api.hackertarget.com/mtr/?q="+ip +" -o traceroute.txt"+" "+ "&& cd ./..")

# dnslookup database

def dnslookup(ip,folder):
    print " "
    print " "
    print (Fore.BLUE+" DSNlookup database ")
    print " ------------------------------------------------------------------------------"
    print " "
    os.system("nslookup "+ip )
    os.system("cd "+folder +"&& curl https://api.hackertarget.com/dnslookup/?q="+ip +" -o dnslookup.txt"+" "+ "&& cd ./..")

# http headers database

def http_headers(ip,folder):
    print " "
    print " "
    print (Fore.GREEN+" https header database ")
    print " ------------------------------------------------------------------------------"
    print " "
    os.system("curl -i "+ip )
    os.system("cd "+folder +"&& curl https://api.hackertarget.com/httpheaders/?q="+ip +" -o http_header.txt"+" "+ "&& cd ./..")



# other common functions
# ----------------------
# ----------------------



# nmap
def nmap_full(ip,folder):
    nm = nmap.PortScanner()
    nm.scan(hosts = ip, arguments = " -sC -sV -R -PN -PS -p- --script vuln -O -oG nmaps_"+ip+".txt")
    os.system("mv nmaps_"+ip+".txt "+folder)
    print(Fore.GREEN+" ")
    os.system("cat "+folder+"/nmaps_"+ip+".txt")
    finished()

# nmap nmap_machines
def nmap_oscp(ip,folder):
    nm = nmap.PortScanner()
    nm.scan(hosts = ip, arguments = " -sC -sV -p- --script vuln -O -oG nmaps_"+ip+".txt")
    os.system("mv nmaps_"+ip+".txt "+folder)
    print(Fore.GREEN+" ")
    os.system("cat "+folder+"/nmaps_"+ip+".txt")
    finished()

# enum4linux
def enum4linux(ip,folder):
    os.system("enum4linux "+ip+" | tee -a enum4linux_"+ip+".txt")
    os.system("mv enum4linux_"+ip+".txt "+folder)



#############################################
#================= Port 80 =================
#############################################

# nikto
def nikto80(ip,folder):
    os.system("nikto -host http://"+ip+" -o nikto_"+ip+".txt")
    os.system("mv nikto_"+ip+".txt "+folder)
    print(Fore.CYAN+" ")
    print " Nikto"
    print " -----"
    os.system("cat "+folder+"/nikto_"+ip+".txt")
    finished()

# gobuster
def gobuster80(ip, folder):
    print(Fore.BLUE+" ")
    os.system(" gobuster  -u http://"+ip+" -r -t 5 -w /usr/share/wordlists/dirb/big.txt -o gobuster_"+ip+".log")
    os.system("mv gobuster_"+ip+".log "+folder)
    print(Fore.YELLOW+" ")
    os.system(" dirb http://"+ip+" -o dirb_"+ip+".txt")
    os.system("mv dirb_"+ip+".txt "+folder)
    finished()
    print " Hold on, results of other scanners are processing :) "



#############################################
#================= Port 443 =================
#############################################

# gobuster url
def gobuster443(ip, folder):
    print(Fore.RED+" ")
    os.system("gobuster  -u https://"+ip+" -r -t 15 -w /usr/share/wordlists/dirb/big.txt -o gobusterurl_"+ip+".log")
    os.system("mv gobusterurl_"+ip+".log "+folder)
    print(Fore.YELLOW+" ")
    os.system("dirb https://"+ip+" -o dirbs_"+ip+".txt")
    os.system("mv dirbs_"+ip+".txt "+folder)
    finished()
    print " Hold on, results of other scanners are processing :) "

# nikto
def nikto443(ip,folder):
    os.system("nikto -host https://"+ip+" -o nikto_"+ip+".txt")
    os.system("mv nikto_"+ip+".txt "+folder)
    print(Fore.CYAN+" ")
    print " Nikto"
    print " -----"
    os.system("cat "+folder+"/nikto_"+ip+".txt")
    finished()

# testssl
def testssl443(ip,folder):
    os.system("./Tools/testssl/testssl.sh "+ip+" | tee -a testssl_"+ip+".txt")
    os.system("mv testssl_"+ip+".txt "+folder)
    os.system("cat "+folder+"/testssl_"+ip+".txt")


#############################################
# =========== Port finding =================
#############################################
def find_ports(ip, folder):
    arr = []
    os.system("nmap -p- "+ip+" -oA "+folder+"/nmap_port")
    os.system("cat "+folder+"/nmap_port.nmap | grep open | cut -d '/' -f 1 > port_all_"+ip+".txt")
    os.system("mv port_all_"+ip+".txt "+folder+"/")
    path = folder+"/port_all_"+ip+".txt"
    fo = open(path, "rw+")
    file_read = fo.readlines()
    for lists in file_read:
        arr.append(lists)
    return arr

# Fininshed message
def finished():
    print "==========================================="
    print "          FINISHED                         "
    print "==========================================="
